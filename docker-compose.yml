version : "3"
services:
    backend:
        # image: suti211/python-tut:flaskapp
        build: ./java-docker/
        volumes:
            - './java-docker/backend-app:/app/backend-app'
        deploy:
            replicas: 1
            resources:
                limits:
                    cpus: "0.4"
                    memory: 1024M
            restart_policy:
                condition: on-failure
        ports:
            - "8080:8443"
        depends_on:
            - redis
        networks:
            - webnet
    vue:
        build: ./vue-docker/
        volumes:
            - './vue-docker/frontend-app:/app/js'
            - './logs:/root/.npm/'
        deploy:
            replicas: 1
            resources:
                limits:
                    cpus: "0.1"
                    memory: 512M
            restart_policy:
                    condition: on-failure
        environment:
            - CHOKIDAR_USEPOLLING=true
            - PORT=8000
        ports:
            - "80:8000"
        depends_on:
            - backend
        networks:
            - webnet
            
    redis:
        image: redis:5.0.3
        deploy:
            replicas: 1
            resources:
                limits:
                    cpus: "0.1"
                    memory: 200M
            restart_policy:
                condition: on-failure
        ports:
            - "6379:6379"
        networks:
            - webnet
            
    db:
        build: ./db-docker/
        volumes:
            - './db-docker/data:/var/lib/mysql'
        deploy:
            replicas: 1
            resources:
                limits:
                    cpus: "0.4"
                    memory: 1024M
            restart_policy:
                condition: on-failure
        restart: always
        environment:
            - MYSQL_ROOT_PASSWORD = 'root'
        ports:
            - "3306:3306"
        networks:
            - webnet
networks:
    webnet: